function CSpriteLibrary(){var e,o,n,s,a,d,p={};this.init=function(t,i,r){e={},n=o=0,s=t,a=i,d=r},this.addSprite=function(t,i){if(p.hasOwnProperty(t))return!1;var r=new Image;return p[t]=e[t]={szPath:i,oSprite:r,bLoaded:!1},o++,!0},this.getSprite=function(t){return p.hasOwnProperty(t)?p[t].oSprite:null},this._onSpritesLoaded=function(){o=0,a.call(d)},this._onSpriteLoaded=function(){s.call(d),++n===o&&this._onSpritesLoaded()},this.loadSprites=function(){for(var t in e)e[t].oSprite.oSpriteLibrary=this,e[t].oSprite.szKey=t,e[t].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey),this.oSpriteLibrary._onSpriteLoaded(this.szKey)},e[t].oSprite.onerror=function(t){var i=t.currentTarget;setTimeout(function(){e[i.szKey].oSprite.src=e[i.szKey].szPath},500)},e[t].oSprite.src=e[t].szPath},this.setLoaded=function(t){p[t].bLoaded=!0},this.isLoaded=function(t){return p[t].bLoaded},this.getNumSprites=function(){return o}}