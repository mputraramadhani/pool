function CGame(){var i,n,s,o,a,r,_,l,h,u,d,c,T,S,E,p,C,f,A,g,M,O=!1;this._init=function(){switch(A=i=!(n=1),g=1,M=COMMAND_STICK_START_SPEED,c=0,s_iGameMode){case GAME_MODE_NINE:BALL_NUMBER=9;break;case GAME_MODE_EIGHT:case GAME_MODE_TIME:BALL_NUMBER=15}RACK_POS=STARTING_RACK_POS[s_iGameMode],d=new createjs.Container,s_oStage.addChild(d);var e=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));d.addChild(e),S=new createjs.Container,d.addChild(S),d=new createjs.Container,s_oStage.addChild(d),h=new CInterface(d),o=new CScene,(u=new CTable(S,GAME_DIFFICULTY_PARAMS[s_iGameDifficulty])).addEventListener(ON_LOST,this.gameOver,this),u.addEventListener(ON_WON,this.showWinPanel,this);l=null,r=new CPlayerGUI(CANVAS_WIDTH/2-400,40,TEXT_PLAYER1,s_oStage),_=new CPlayerGUI(CANVAS_WIDTH/2+400,40,TEXT_PLAYER2,s_oStage),s_iPlayerMode===GAME_MODE_CPU&&(l=new CScoreGUI(CANVAS_WIDTH/2,40,s_oStage)),1===n?(r.highlight(),_.unlight()):(_.highlight(),r.unlight()),s_iGameMode===GAME_MODE_NINE&&this.setNextBallToHit(1),S=new createjs.Container,s_oStage.addChild(S),(E=new CInputController(S)).addEventListener(ON_PRESS_DOWN_BUT_ARROW_LEFT,this._onPressDownStickCommand,this,-1),E.addEventListener(ON_PRESS_UP_BUT_ARROW_LEFT,this._onPressUpStickCommand,this),E.addEventListener(ON_PRESS_DOWN_BUT_ARROW_RIGHT,this._onPressDownStickCommand,this,1),E.addEventListener(ON_PRESS_UP_BUT_ARROW_RIGHT,this._onPressUpStickCommand,this),C=new createjs.Container,s_oStageUpper3D.addChild(C),f=new createjs.Container,s_oStage.addChild(f),s_bMobile&&(p=new CShotPowerBar(C,123,260,f));var t=new createjs.Shape;t.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStageUpper3D.addChild(t),tweenVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME,1e3),(a=new CGameOverPanel(s_oStageUpper3D)).addEventListener(ON_EXIT_GAME,this.onExit,this),a.addEventListener(ON_RESTART,this.restartGame,this),T=null,s_bInteractiveHelp?((T=new CInteractiveHelp(s_oStageUpper3D)).addEventListener(ON_END_TUTORIAL,this._onEndTutorial,this),$("#canvas_upper_3d").css("pointer-events","initial"),s_bInteractiveHelp=!1):this._onEndTutorial(),createjs.Tween.get(t).to({alpha:0},1e3,createjs.Ease.cubicIn).call(function(){s_oStageUpper3D.removeChild(t),s_oGame._startInteractiveHelp()}),this.refreshButtonPos(),sizeHandler(),createjs.Tween.get(o).wait(s_iTimeElaps).call(o.update,null,o)},this._startInteractiveHelp=function(){T&&(s_bMobile?(T.startTutorial({tutorial:TUTORIAL_MOVE_STICK_MOBILE,info:{movement:!1,on_show_tutorial:void 0}}),T.startTutorial({tutorial:TUTORIAL_SHOT_MOBILE,info:{movement:!1,on_show_tutorial:void 0,param:p}}),T.startTutorial({tutorial:TUTORIAL_MOVE_STICK_BUTTONS,info:{movement:!1,on_show_tutorial:void 0}})):T.startTutorial({tutorial:TUTORIAL_SHOT_DESKTOP,info:{movement:!1,on_show_tutorial:void 0,param:p}}),T.startTutorial({tutorial:TUTORIAL_CUE_EFFECT,info:{movement:!1,on_show_tutorial:void 0}}),T.startTutorial({tutorial:TUTORIAL_RESPOT_CUE,info:{movement:!1,on_show_tutorial:void 0}}))},this._onMouseDownPowerBar=function(){s_oTable.startToShot()},this._onPressMovePowerBar=function(e){s_oTable.holdShotStickMovement(e)},this._onPressUpPowerBar=function(){s_oTable.startStickAnimation()&&p.setInput(!1)},this.hideShotBar=function(){s_bMobile&&p.hide()},this.showShotBar=function(){s_bMobile&&p.show()},this._onEndTutorial=function(){$("#canvas_upper_3d").css("pointer-events","none"),O=!0,s_bMobile&&(p.initEventListener(),p.addEventListener(ON_MOUSE_DOWN_POWER_BAR,this._onMouseDownPowerBar,this),p.addEventListener(ON_PRESS_MOVE_POWER_BAR,this._onPressMovePowerBar,this),p.addEventListener(ON_PRESS_UP_POWER_BAR,this._onPressUpPowerBar,this),p.show()),T&&(T.unload(),T=null)},this._onPressDownStickCommand=function(e){g=e,A=!0,M=COMMAND_STICK_START_SPEED},this._onPressUpStickCommand=function(){A=!1},this.unload=function(e=null,t){O=!1;var i=new createjs.Shape;i.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),i.alpha=0,s_oStageUpper3D.addChild(i),createjs.Tween.get(i).to({alpha:1},700,createjs.Ease.cubicIn).call(function(){u.unload(),h.unload(),o.unload(),a.unload(),s_oStageUpper3D.removeAllChildren(),s_oStage.removeAllChildren(),null!==e&&e.call(t)})},this.reset=function(){i=!(n=1)},this.refreshButtonPos=function(){h.refreshButtonPos(),r.refreshButtonPos(),_.refreshButtonPos(),E.refreshOffsetPos(),f.x=C.x=.5*s_iOffsetX,T&&T.refreshButtonsPos(),l&&l.refreshButtonPos()},this.setNextBallToHit=function(e){1===n?(_.setBallVisible(!1),r.setBall(e)):(r.setBallVisible(!1),_.setBall(e))},this.changeTurn=function(e){1===n?(n=2,s_oTable.isCpuTurn()||s_oGame.showShotBar(),_.highlight(),r.unlight()):(n=1,r.highlight(),_.unlight(),s_oGame.showShotBar()),s_oInterface.resetSpin(),e?new CEffectText(TEXT_FAULT,s_oStageUpper3D):new CEffectText(TEXT_CHANGE_TURN,s_oStageUpper3D)},this.assignSuits=function(e){s=new Array,e<8?1===n?(s[0]="solid",s[1]="stripes",this.setBallInInterface("solid")):(s[0]="stripes",s[1]="solid",this.setBallInInterface("stripes")):1===n?(s[0]="stripes",s[1]="solid",this.setBallInInterface("stripes")):(s[0]="solid",s[1]="stripes",this.setBallInInterface("solid")),i=!0},this.setBallInInterface=function(e){"solid"==e?(r.setBall(2),_.setBall(15)):(r.setBall(15),_.setBall(2))},this.isLegalShotFor8Ball=function(e,t){return i?"solid"==s[n-1]&&e<8||("stripes"==s[n-1]&&8<e||8==e&&0==t):8!=e},this.increaseWinStreak=function(){0},this.resetWinStreak=function(){0},this.gameOver=function(e){a.show(e),$("#canvas_upper_3d").css("pointer-events","initial"),O=!1},this.showWinPanel=function(e){var t=s_iGameMode===GAME_MODE_CPU?c:void 0;a.show(e,t),$("#canvas_upper_3d").css("pointer-events","initial"),O=!1},this.onExit=function(){o.update(),tweenVolume("soundtrack",SOUNDTRACK_VOLUME_DEFAULT,1e3),this.unload(s_oMain.gotoMenu,s_oMain),$(s_oMain).trigger("show_interlevel_ad"),$(s_oMain).trigger("end_session")},this.restartGame=function(){o.update(),this.unload(s_oMain.gotoGame,s_oMain),$(s_oMain).trigger("show_interlevel_ad"),$(s_oMain).trigger("end_session")},this.updateScore=function(e){l&&(c=(e=c+e)<0?0:e,l.refreshScore(c),l.highlight())},this.getCurTurn=function(){return n},this.getNextTurn=function(){return 1===n?2:1},this.getSuiteForCurPlayer=function(){return s[n-1]},this.isSuiteAssigned=function(){return i},this.getPlayer1Name=function(){return r.getPlayerName()},this.getPlayer2Name=function(){return _.getPlayerName()},this._updateInput=function(){A&&(u.rotateStick(g*M),(M+=COMMAND_STICK_SPEED_INCREMENT)>=COMMAND_STICK_MAX_SPEED&&(M=COMMAND_STICK_MAX_SPEED))},this.update=function(){!1!==O&&(this._updateInput(),u.update(),o.update())},(s_oGame=this)._init()}var s_oGame=null;